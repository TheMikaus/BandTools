# Google Drive Sync Feature

## Quick Start

AudioBrowser now supports cloud synchronization via Google Drive, making it easy to share practice sessions with your band members!

### ğŸš€ Get Started in 5 Minutes

1. **Set up Google Drive credentials** (one-time, 5 min)
   - See [GOOGLE_DRIVE_SETUP.md](GOOGLE_DRIVE_SETUP.md)
   
2. **Click the Sync button** (â˜ in toolbar)
   
3. **Choose your sync folder** (first time only)
   
4. **Select files to sync** (with checkboxes)
   
5. **Done!** Your band can now access your recordings and annotations

## What Gets Synced

### Automatically Synced (with your approval):
- âœ… Your annotations (`.audio_notes_YourName.json`)
- âœ… Song names (`.provided_names.json`)
- âœ… Duration cache (`.duration_cache.json`)
- âœ… Audio fingerprints (`.audio_fingerprints.json`)
- âœ… User colors (`.user_colors.json`)

### You Choose:
- ğŸµ Audio files (`.wav`, `.mp3`) - Select which recordings to share

### Never Synced:
- âŒ Backups (`.backup/`)
- âŒ Waveform cache (`.waveforms/`)
- âŒ Temporary files

## Key Features

### ğŸ”’ Multi-User Support
- Each band member has their own annotation file
- You can see others' annotations (read-only)
- You can only modify your own annotations
- Shared metadata (song names, etc.)

### ğŸ“Š Version Tracking
- Smart version management prevents conflicts
- See what changed since last sync
- Incremental updates (no re-downloading everything)
- Operation history tracked

### âœ“ Safety First
- Every operation requires your approval
- File-by-file selection with checkboxes
- All operations logged
- No automatic deletions

### âš¡ Efficient
- Only sync what you need
- Resumable uploads for large files
- Background operations (non-blocking UI)
- Smart file comparison

## Documentation

- **[GOOGLE_DRIVE_SETUP.md](GOOGLE_DRIVE_SETUP.md)** - Complete setup guide
- **[SYNC_WORKFLOW_EXAMPLE.md](SYNC_WORKFLOW_EXAMPLE.md)** - Example workflows
- **[credentials.json.example](credentials.json.example)** - Template file

## How It Works

### For the Band Leader (First Sync)

```
1. Record practice session
2. Click "â˜ Sync"
3. Select "Upload"
4. Check files to upload
5. Click "Upload Selected"
6. Share folder name with band
```

### For Band Members

```
1. Set up Google Drive credentials
2. Click "â˜ Sync"
3. Enter shared folder name
4. Select "Download"
5. Choose which files to download
6. Add your own annotations
7. Upload your annotations
```

## Requirements

- Python 3.7+
- PyQt6 (auto-installed)
- Google account
- Internet connection

### Python Packages (auto-installed on first use)
- `google-auth-oauthlib`
- `google-api-python-client`

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AudioBrowser (audio_browser.py)â”‚
â”‚                                     â”‚
â”‚  - Sync button in toolbar          â”‚
â”‚  - Settings storage                â”‚
â”‚  - UI integration                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â–º gdrive_sync.py
               â”‚   - OAuth authentication
               â”‚   - File upload/download
               â”‚   - Version management
               â”‚   - User permissions
               â”‚
               â””â”€â–º sync_dialog.py
                   - Folder selection
                   - Sync review UI
                   - Progress tracking
                   - Status display
```

## Files Added

```
AudioBrowserAndAnnotation/
â”œâ”€â”€ gdrive_sync.py              (19.7 KB) Core sync engine
â”œâ”€â”€ sync_dialog.py              (16.3 KB) UI dialogs
â”œâ”€â”€ GOOGLE_DRIVE_SETUP.md       ( 6.1 KB) Setup guide
â”œâ”€â”€ SYNC_WORKFLOW_EXAMPLE.md    ( 7.4 KB) Usage examples
â”œâ”€â”€ SYNC_README.md              (this file)
â”œâ”€â”€ credentials.json.example    Template for OAuth
â””â”€â”€ (generated by user)
    â”œâ”€â”€ credentials.json        Your OAuth credentials
    â”œâ”€â”€ token.json              Saved authorization
    â””â”€â”€ .sync_version.json      Version tracking (per folder)
```

## Common Questions

### Q: Do I need to register an app with Google?
**A:** Yes, but it's your own personal "app" just for your band. Takes 5 minutes. See [GOOGLE_DRIVE_SETUP.md](GOOGLE_DRIVE_SETUP.md).

### Q: Is my data safe?
**A:** Yes! Your credentials stay on your machine, and you control what gets synced. All operations require your approval.

### Q: Can others edit my annotations?
**A:** No, each person's annotations are read-only to others. You can see them but not modify them.

### Q: What if two people sync at the same time?
**A:** Each upload creates a new version. The version system tracks changes. Last upload wins, but nothing is lost.

### Q: Do I need to sync every folder?
**A:** No, each practice folder syncs independently. Sync only what you want to share.

### Q: How much Google Drive space do I need?
**A:** Metadata files are tiny (KB). Audio files vary:
- MP3: ~3-10 MB per song
- WAV: ~30-50 MB per song
- 10-song practice session (WAV): ~300-500 MB

### Q: Can I use this with multiple bands?
**A:** Yes! Create different Google Drive folders for each band.

## Troubleshooting

### Authentication Issues
```bash
# Delete token and re-authorize
rm token.json
# Then click "â˜ Sync" again
```

### Can't Find Folder
```bash
# Check folder name spelling
# Or create a new folder with a different name
```

### Upload Fails
```bash
# Check logs
tail -f audiobrowser.log

# Common causes:
# - Network issues
# - File in use (close player)
# - Out of Google Drive space
```

### Python Package Issues
```bash
# Manually install packages
pip install google-auth-oauthlib google-api-python-client
```

## Development Notes

### Testing
```bash
# Run logic tests (no GUI needed)
python3 /path/to/test_sync_logic.py
```

### Code Structure
- **gdrive_sync.py**: Pure Python, no Qt dependencies
- **sync_dialog.py**: Pure Qt, no Google dependencies
- **audio_browser.py**: Integration layer

### Adding Features
See comments in code for extension points:
- Custom sync filters
- Additional file types
- Conflict resolution strategies
- Scheduled sync

## Support

- **Issues**: https://github.com/TheMikaus/BandTools/issues
- **Logs**: Check `audiobrowser.log` in app directory
- **Docs**: All markdown files in this directory

## License

Part of BandTools project. See repository LICENSE.

## Credits

- Implemented using Google Drive API v3
- OAuth 2.0 desktop flow
- Built with PyQt6

---

**Happy Syncing! ğŸµâ˜ï¸**

*Now your band can share practice sessions, collaborate on annotations, and keep everyone in sync!*
